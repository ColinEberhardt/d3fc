<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Zoom Interactions</title>
    <meta name="description" content="A collection of components that make it easy to build interactive charts with D3.">

    <script src="https://d3fc.io/lib/d3.min.js"></script>
    <script src="https://d3fc.io/lib/jquery.min.js"></script>
    <script src="https://d3fc.io/lib/bootstrap.min.js"></script>
    <script src="https://d3fc.io/lib/d3fc.min.js"></script>
    <script src="https://d3fc.io/lib/d3-legend.min.js"></script>
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-96x96.png" sizes="96x96">
    <link rel="stylesheet" href="https://d3fc.io/styles.css" />
    <link rel="canonical" href="https://d3fc.io/examples/zoom/index.html" />
  </head>
  <body>
    <div class="content">

      <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
              <a href="https://d3fc.io/"><img class="navbar-logo" alt="d3fc" src="https://d3fc.io/images/logo.svg" /></a>
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li class=""><a href="https://d3fc.io/introduction/getting-started.html">Documentation</a></li>
                <li class="">
                  <a href="https://d3fc.io/api/annotation-api.html">API</a>
                </li>
                <li class="active">
                  <a href="https://d3fc.io/examples/bubble/">Examples</a>
                    <ul class="sub-nav">
                          <li class="sub-nav-item">
                            <a class="" href="/examples/bubble/index.html">Bubble Chart</a>
                          </li>
                          <li class="sub-nav-item">
                            <a class="" href="/examples/simple/index.html">Line / Area Chart</a>
                          </li>
                          <li class="sub-nav-item">
                            <a class="" href="/examples/stacked/index.html">Stacked Bar</a>
                          </li>
                          <li class="sub-nav-item">
                            <a class="" href="/examples/streaming/index.html">Streaming Financial Chart</a>
                          </li>
                          <li class="sub-nav-item">
                            <a class="active" href="/examples/zoom/index.html">Zoom Interactions</a>
                          </li>
                    </ul>
                </li>
                <li><a href="https://github.com/d3fc/d3fc">GitHub</a></li>
              </ul>
            </div>
        </div>
      </nav>

      <div class="container example">
  <div class="row">
    <div class="col-sm-9 col-xs-12">
      <h1>
        Zoom Interactions
      </h1>
      <div class="codepen-link">
  <form action="https://codepen.io/pen/define" method="POST" target="_blank">
    <input type="text" name="data" hidden="true"
      value='{
        "html":"&lt;div id&#x3D;\&quot;zoom-chart\&quot; class&#x3D;\&quot;chart large\&quot;&gt;&lt;/div&gt;\n",
        "js": "// create some test data\nvar generator = fc.randomGeometricBrownianMotion()\n    .steps(1000);\nvar data = generator(10);\n\nvar yExtent = fc.extentLinear()\n  .pad([0.1, 0.1]);\n\n// create the scales\nvar x = d3.scaleLinear()\n  .domain([0, data.length]);\nvar y = d3.scaleLinear()\n  .domain(yExtent(data));\n\n// a secondary x-scale, which is always set to the full domain\n// extent, for the purposes of computing the zoom\nvar x2 = x.copy();\n\n// create the various series\nvar area = fc.seriesSvgArea()\n  .crossValue(function(d, i) { return i; })\n  .mainValue(function(d) { return d; })\n  .decorate(function(selection) {\n    selection.enter()\n      .style(\"fill\", \"lightgreen\")\n      .style(\"fill-opacity\", 0.5);\n  });\n\nvar gridlines = fc.annotationSvgGridline();\n\nvar multi = fc.seriesSvgMulti()\n  .series([gridlines, area]);\n\n// create a d3-zoom that handles the mouse / touch interactions\nvar zoom = d3.zoom()\n  .on(\"zoom\", function() {\n    // use the rescaleX utility function to compute the new scale\n    var rescaled = d3.event.transform.rescaleX(x2);\n    // update the x scale used by the chart to use the udpated domain\n    x.domain(rescaled.domain());\n    render();\n  });\n\n// the chart!\nvar chart = fc.chartSvgCartesian(x, y)\n  .chartLabel(\"d3-zoom integration example\")\n  .plotArea(multi)\n  .decorate((sel) => {\n    // add the zoom interaction on the enter selection\n    sel.enter()\n      .select(\".plot-area\")\n      .on(\"measure.range\", () => {\n        x2.range([0, d3.event.detail.width]);\n      })\n      .call(zoom)\n      // initialise the zoom at x10\n      .call(zoom.transform, d3.zoomIdentity.scale(10));\n  });\n\nfunction render() {\n  // update the y-domain based on the visible range\n  var visibleRange = data.slice(\n    Math.max(0, x.domain()[0]),\n    Math.min(x.domain()[1], data.length)\n  );\n  y.domain(yExtent(visibleRange));\n\n  // render the chart!\n  d3.select(\"#zoom-chart\")\n    .datum(data)\n    .call(chart);\n}\n\nrender();\n",
        "css": ".chart-label {\n  font-size: 1.5em;\n  line-height: normal;\n  color: black;\n}\n\n.chart {\n  margin: 10px 0;\n  width: 100%;\n  height: 250px;\n}\n\n.chart svg {\n  overflow: visible !important;\n}\n\n.chart.large {\n  height: 400px;\n}\n\n.plot-area {\n  background-color: white;\n}\n\n.y-axis-label {\n  white-space: nowrap;\n}\n",
        "js_external": "https://code.jquery.com/jquery-3.1.1.slim.min.js;https://d3js.org/d3.v4.js;https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.18.0/d3-legend.js;https://d3fc.io/lib/d3fc.min.js"
      }'/>
    <input type="submit" class="btn btn-default" value="Codepen"/>
  </form>
</div>

<div id='zoom-chart' class='chart large'></div>

<script type="text/javascript">
    (function() {
        // create some test data
var generator = fc.randomGeometricBrownianMotion()
    .steps(1000);
var data = generator(10);

var yExtent = fc.extentLinear()
  .pad([0.1, 0.1]);

// create the scales
var x = d3.scaleLinear()
  .domain([0, data.length]);
var y = d3.scaleLinear()
  .domain(yExtent(data));

// a secondary x-scale, which is always set to the full domain
// extent, for the purposes of computing the zoom
var x2 = x.copy();

// create the various series
var area = fc.seriesSvgArea()
  .crossValue(function(d, i) { return i; })
  .mainValue(function(d) { return d; })
  .decorate(function(selection) {
    selection.enter()
      .style('fill', 'lightgreen')
      .style('fill-opacity', 0.5);
  });

var gridlines = fc.annotationSvgGridline();

var multi = fc.seriesSvgMulti()
  .series([gridlines, area]);

// create a d3-zoom that handles the mouse / touch interactions
var zoom = d3.zoom()
  .on('zoom', function() {
    // use the rescaleX utility function to compute the new scale
    var rescaled = d3.event.transform.rescaleX(x2);
    // update the x scale used by the chart to use the udpated domain
    x.domain(rescaled.domain());
    render();
  });

// the chart!
var chart = fc.chartSvgCartesian(x, y)
  .chartLabel('d3-zoom integration example')
  .plotArea(multi)
  .decorate((sel) => {
    // add the zoom interaction on the enter selection
    sel.enter()
      .select('.plot-area')
      .on('measure.range', () => {
        x2.range([0, d3.event.detail.width]);
      })
      .call(zoom)
      // initialise the zoom at x10
      .call(zoom.transform, d3.zoomIdentity.scale(10));
  });

function render() {
  // update the y-domain based on the visible range
  var visibleRange = data.slice(
    Math.max(0, x.domain()[0]),
    Math.min(x.domain()[1], data.length)
  );
  y.domain(yExtent(visibleRange));

  // render the chart!
  d3.select('#zoom-chart')
    .datum(data)
    .call(chart);
}

render();

    })();
</script>


<p>This example shows how to integrate the d3fc Cartesian chart component with the D3 zoom behavior. Here&#39;s a brief summary of the code:</p>
<ul>
<li>The geometric Brownian motion generator component from the <a href="/api/random-data-api.html">d3fc-random-data</a> is used to create a random data series.</li>
<li>The data is rendered via an <a href="/api/series-api.html#area">area series</a>, which is combined with  <a href="/api/annotation-api.html#gridline">gridlines</a> via the <a href="/api/series-api.html#multi">multi series</a> component. These are rendered on a <a href="/api/chart-api.html">Cartesian chart</a>.</li>
<li>The <a href="https://github.com/d3/d3-zoom">D3 zoom</a> component is used to capture mouse / touch interactions. This is added to the Cartesian chart via the decorate function, which provides access to the plot-area enter selection.</li>
<li>When a zoom event occurs, the <code>rescaleX</code> utility function is used to update the x scale domain.</li>
<li>Whenever the chart is rendered, the y scale is adjusted based on the visible range of data.</li>
</ul>
<p>This example also shows a couple of interesting features of <a href="/api/element-api.html">d3fc-element</a>, which is used internally by the Cartesian chart.</p>
<ol>
<li>The layout is performed by Cartesian chart, which results in the scale ranges being set. In order to access this measurement, the <code>measure</code> event fired by the underlying <a href="/api/element-api.html">d3fc-element components</a> is handled.</li>
<li>The use of <a href="/api/element-api.html">d3fc-element</a>, which manages the measure and render cycles, ensures that the chart updates are &#39;latched&#39; to the browser animation frames.</li>
</ol>
<pre><code class="lang-js"><span class="hljs-comment">// create some test data</span>
<span class="hljs-keyword">var</span> generator = fc.randomGeometricBrownianMotion()
    .steps(<span class="hljs-number">1000</span>);
<span class="hljs-keyword">var</span> data = generator(<span class="hljs-number">10</span>);

<span class="hljs-keyword">var</span> yExtent = fc.extentLinear()
  .pad([<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>]);

<span class="hljs-comment">// create the scales</span>
<span class="hljs-keyword">var</span> x = d3.scaleLinear()
  .domain([<span class="hljs-number">0</span>, data.length]);
<span class="hljs-keyword">var</span> y = d3.scaleLinear()
  .domain(yExtent(data));

<span class="hljs-comment">// a secondary x-scale, which is always set to the full domain</span>
<span class="hljs-comment">// extent, for the purposes of computing the zoom</span>
<span class="hljs-keyword">var</span> x2 = x.copy();

<span class="hljs-comment">// create the various series</span>
<span class="hljs-keyword">var</span> area = fc.seriesSvgArea()
  .crossValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>{ <span class="hljs-keyword">return</span> i; })
  .mainValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d; })
  .decorate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selection</span>) </span>{
    selection.enter()
      .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'lightgreen'</span>)
      .style(<span class="hljs-string">'fill-opacity'</span>, <span class="hljs-number">0.5</span>);
  });

<span class="hljs-keyword">var</span> gridlines = fc.annotationSvgGridline();

<span class="hljs-keyword">var</span> multi = fc.seriesSvgMulti()
  .series([gridlines, area]);

<span class="hljs-comment">// create a d3-zoom that handles the mouse / touch interactions</span>
<span class="hljs-keyword">var</span> zoom = d3.zoom()
  .on(<span class="hljs-string">'zoom'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// use the rescaleX utility function to compute the new scale</span>
    <span class="hljs-keyword">var</span> rescaled = d3.event.transform.rescaleX(x2);
    <span class="hljs-comment">// update the x scale used by the chart to use the udpated domain</span>
    x.domain(rescaled.domain());
    render();
  });

<span class="hljs-comment">// the chart!</span>
<span class="hljs-keyword">var</span> chart = fc.chartSvgCartesian(x, y)
  .chartLabel(<span class="hljs-string">'d3-zoom integration example'</span>)
  .plotArea(multi)
  .decorate(<span class="hljs-function">(<span class="hljs-params">sel</span>) =&gt;</span> {
    <span class="hljs-comment">// add the zoom interaction on the enter selection</span>
    sel.enter()
      .select(<span class="hljs-string">'.plot-area'</span>)
      .on(<span class="hljs-string">'measure.range'</span>, () =&gt; {
        x2.range([<span class="hljs-number">0</span>, d3.event.detail.width]);
      })
      .call(zoom)
      <span class="hljs-comment">// initialise the zoom at x10</span>
      .call(zoom.transform, d3.zoomIdentity.scale(<span class="hljs-number">10</span>));
  });

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// update the y-domain based on the visible range</span>
  <span class="hljs-keyword">var</span> visibleRange = data.slice(
    <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, x.domain()[<span class="hljs-number">0</span>]),
    <span class="hljs-built_in">Math</span>.min(x.domain()[<span class="hljs-number">1</span>], data.length)
  );
  y.domain(yExtent(visibleRange));

  <span class="hljs-comment">// render the chart!</span>
  d3.select(<span class="hljs-string">'#zoom-chart'</span>)
    .datum(data)
    .call(chart);
}

render();
</code></pre>

    </div>

    <nav class="col-sm-3 hidden-xs">
      <ul class="nav nav-stacked fixed nav-sidebar">
        <li>
          <h4>Examples</h4>
          <ul class="nav nav-stacked">
                <li class="">
                  <a href="/examples/bubble/index.html">Bubble Chart</a>
                </li>
                <li class="">
                  <a href="/examples/simple/index.html">Line / Area Chart</a>
                </li>
                <li class="">
                  <a href="/examples/stacked/index.html">Stacked Bar</a>
                </li>
                <li class="">
                  <a href="/examples/streaming/index.html">Streaming Financial Chart</a>
                </li>
                <li class="active">
                  <a href="/examples/zoom/index.html">Zoom Interactions</a>
                </li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>

</div>


    </div>
    <footer>
      <div class="container">
        <p class="muted credit text-center">Project supported by <a href="http://www.scottlogic.com">Scott Logic</a>.</p>
      </div>
    </footer>
  </body>
</html>
